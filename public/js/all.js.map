{"version":3,"sources":["imageBuilder.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"all.js","sourcesContent":["  $(function() {\n\n    $('#canvasForm').on('submit',function(e){\n      e.preventDefault();\n\n      var canvas,\n      context,\n      imageObj = new Image();\n\n      var $form         = $(this);\n      var imagePath     = this.imgPath.value;\n      var firstWord     = this.first.value.toUpperCase();\n      var secondWord    = this.second.value.toUpperCase();\n      var boxColor      = this.color.value;\n      var $targetImage  = $('#targetImage');\n      var $updatedImage = $('#updated-image');\n\n      //determines how far down the image/canvas to place the words and colorbox\n      var overlayPlacementModifier = 3;\n\n      \n\n      initiateCanvas();\n\n      imageObj.onload = function() {\n\n        setDimensionsOfCanvasToImageSize(this);\n        convertTograyScale();\n        drawOverlayBox(this);\n        setUpFont('160px league-gothic', 'white');\n\n        var firstWidth = getTextWidth(firstWord);\n        addWordToCanvas(firstWord, firstWidth, this);\n\n        context.save();\n        var secondWidth = getTextWidth(secondWord);\n        flipText();\n        addWordToCanvas(secondWord, secondWidth, this, true);\n        context.restore();\n\n        updateImgToUserGeneratedImage();\n\n        sendAjaxRequest($form.serialize());\n      };  \n\n      function flipText(){\n        context.rotate(Math.PI);\n      }\n\n      function initiateCanvas(){\n        canvas = document.createElement(\"canvas\");\n        context = canvas.getContext('2d');\n        imageObj = new Image();\n        imageObj.crossOrigin = \"Anonymous\";\n\n        //fires imgObj.onload\n        imageObj.src = imagePath;\n      }  \n\n      function setDimensionsOfCanvasToImageSize(imgRef)\n      {\n        canvas.width = imgRef.width;\n        canvas.height = imgRef.height;\n        context.drawImage(imageObj, 0, 0);\n      }\n\n      function drawOverlayBox(imgRef){\n        context.save();\n        context.globalAlpha = 0.4;\n        context.fillStyle = boxColor;\n        var intendedBoxPosition = imgRef.height / overlayPlacementModifier;\n        context.fillRect(0, imgRef.height - intendedBoxPosition, imgRef.width, imgRef.height / 2);\n        context.restore();\n      }  \n\n      function setUpFont(fontFace, color){\n        context.font = fontFace;\n        context.fillStyle = color;\n      }\n\n      function getTextWidth(word){\n        return context.measureText(word).width;\n      }\n\n      function addWordToCanvas(word, wordWidth, imgRef, reverse){\n        reverse = typeof reverse !== 'undefined' ? reverse : false;\n        var intendedWordPosition = imgRef.height / overlayPlacementModifier;\n        if(reverse){\n          context.fillText(word, -(imgRef.width + wordWidth) / 2, -(imgRef.height - intendedWordPosition + 5));\n        }else{\n          context.fillText(word, (imgRef.width - wordWidth) / 2, imgRef.height - intendedWordPosition - 5);  \n        }\n      }\n\n      function updateImgToUserGeneratedImage(){\n        var imageData = canvas.toDataURL();\n        $updatedImage.val(imageData);\n      }\n\n      function convertTograyScale() {\n        var imgData = context.getImageData(0, 0, canvas.width, canvas.height);\n        var pixels  = imgData.data;\n        for (var i = 0, n = pixels.length; i < n; i += 4) {\n          var grayscale = pixels[i] * .3 + pixels[i+1] * .59 + pixels[i+2] * .11;\n            pixels[i  ] = grayscale;        // red\n            pixels[i+1] = grayscale;        // green\n            pixels[i+2] = grayscale;        // blue\n            //pixels[i+3]              is alpha\n          }\n        //redraw the image in black & white\n        context.putImageData(imgData, 0, 0);\n      }\n\n\n      function sendAjaxRequest(data){\n        $.ajax({\n          type: 'POST',\n          url: $form.attr('action'),\n          data: data,\n          dataType: 'text',\n          success:function(data){\n            setTimeout(function(){\n              window.location.href = \"gallery\";\n            }, 500)\n          },\n          error:function(){\n            // failed request; give feedback to user\n            console.log(\"error data\");\n          }\n        });\n      }\n\n    });\n\n\n\n});\n"],"sourceRoot":"/source/"}